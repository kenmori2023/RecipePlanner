<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Recipe | RecipePlanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #fff;
    }
    .navbar {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .navbar .logo { font-size: 1.5rem; font-weight: 700; color: #fff; text-decoration: none; }
    .navbar a { color: #4facfe; text-decoration: none; font-weight: 500; }
    .container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
    h1 {
      font-size: 2rem;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
    }
    .card h3 { color: #4facfe; margin-bottom: 20px; font-size: 1.1rem; }
    label { display: block; color: #aaa; margin-bottom: 5px; font-size: 0.9rem; }
    input, textarea, select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      color: #fff;
      font-family: 'Poppins', sans-serif;
      font-size: 0.95rem;
      margin-bottom: 15px;
      transition: all 0.3s;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #4facfe;
      background: rgba(255,255,255,0.1);
    }
    input::placeholder, textarea::placeholder { color: #666; }
    select { cursor: pointer; }
    select option { background: #1a1a2e; color: #fff; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-family: 'Poppins', sans-serif;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-block;
    }
    .btn-primary {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: #1a1a2e;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3); }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .btn-danger { background: #ff6b6b; color: #fff; }
    .btn-sm { padding: 8px 15px; font-size: 0.85rem; }
    .ingredient-entry {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
    }
    .ingredient-entry .row { grid-template-columns: 2fr 1fr 1fr; }
    .actions { display: flex; gap: 15px; margin-top: 20px; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="logo">üç≥ RecipePlanner</a>
    <a href="/recipes">‚Üê Back to Recipes</a>
  </nav>

  <div class="container">
    <h1>‚ûï Add New Recipe</h1>
    
    <form method="post" action="/recipes">
      <div class="card">
        <h3>Basic Info</h3>
        <label>Recipe Name *</label>
        <input name="title" placeholder="e.g., Spaghetti Carbonara" required>
        
        <label>Cuisine</label>
        <input name="cuisine" placeholder="e.g., Italian, Mexican, Japanese">
        
        <label>Description</label>
        <textarea name="description" placeholder="Describe your recipe..." rows="4"></textarea>
        
        <div class="row">
          <div>
            <label>Prep Time (minutes)</label>
            <input name="prep_minutes" type="number" min="0" placeholder="15">
          </div>
          <div>
            <label>Cook Time (minutes)</label>
            <input name="cook_minutes" type="number" min="0" placeholder="30">
          </div>
        </div>
      </div>

      <div class="card">
        <h3>ü•´ Select Existing Ingredients</h3>
        <div id="existing-ingredients-container"></div>
        <button type="button" class="btn btn-secondary btn-sm" onclick="addExistingIngredient()">+ Add Existing Ingredient</button>
      </div>

      <div class="card">
        <h3>üÜï Add New Ingredients</h3>
        <div id="new-ingredients-container"></div>
        <button type="button" class="btn btn-secondary btn-sm" onclick="addNewIngredient()">+ Add New Ingredient</button>
      </div>

      <div class="actions">
        <button type="submit" class="btn btn-primary">Create Recipe</button>
        <a href="/recipes" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>

  <script>
    const INGREDIENTS = <%- JSON.stringify(ingredients) %>;

    function addExistingIngredient() {
      const i = document.querySelectorAll('#existing-ingredients-container .ingredient-entry').length;
      const div = document.createElement('div');
      div.className = 'ingredient-entry';
      div.innerHTML = `
        <div class="row">
          <div>
            <label>Ingredient</label>
            <select name="existing[${i}][id]" required>
              <option value="">-- choose --</option>
              ${INGREDIENTS.map(ing => `<option value="${ing.id}">${ing.name}</option>`).join('')}
            </select>
          </div>
          <div>
            <label>Quantity</label>
            <input name="existing[${i}][quantity]" type="number" step="0.01" placeholder="2">
          </div>
          <div>
            <label>Unit</label>
            <select name="existing[${i}][unit]">
              <option value="">--</option>
              <option>cup</option><option>tbsp</option><option>tsp</option>
              <option>g</option><option>ml</option><option>oz</option><option>unit</option>
            </select>
          </div>
        </div>
        <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()" style="margin-top:10px">üóëÔ∏è Remove</button>
      `;
      document.getElementById('existing-ingredients-container').appendChild(div);
    }

    function addNewIngredient() {
      const c = document.getElementById('new-ingredients-container');
      const i = c.children.length;
      const div = document.createElement('div');
      div.className = 'ingredient-entry';
      div.innerHTML = `
        <div class="row" style="grid-template-columns: 2fr 1fr 1fr;">
          <div>
            <label>Name *</label>
            <input name="new_ingredients[${i}][name]" placeholder="e.g., Garlic" required>
          </div>
          <div>
            <label>Quantity</label>
            <input name="new_ingredients[${i}][quantity]" type="number" step="0.01">
          </div>
          <div>
            <label>Unit</label>
            <select name="new_ingredients[${i}][unit]">
              <option value="">--</option>
              <option>cup</option><option>tbsp</option><option>tsp</option>
              <option>g</option><option>oz</option><option>ml</option><option>unit</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:10px;">
          <div>
            <label>Price ($)</label>
            <input name="new_ingredients[${i}][price]" type="number" step="0.01" placeholder="2.50">
          </div>
          <div>
            <label>Prep Notes</label>
            <input name="new_ingredients[${i}][preparation]" placeholder="e.g., minced">
          </div>
        </div>
        <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()" style="margin-top:10px">üóëÔ∏è Remove</button>
      `;
      c.appendChild(div);
    }
  </script>
</body>
</html>
