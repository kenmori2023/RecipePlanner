<!doctype html>
<html>
  <body>
    <h2>Add a New Recipe</h2>
    <form method="post" action="/recipes">
      <p><input name="title" placeholder="Name" required></p>
      <p><input name="cuisine" placeholder="Cuisine"></p>
      <p><textarea name="description" placeholder="Description" rows="5" style="width:400px; resize: none;"></textarea></p>
      <p><input name="prep_minutes" type="number" placeholder="Prep Time (min)"></p>
      <p><input name="cook_minutes" type="number" placeholder="Cook Time (min)"></p>

      <h3>Select Existing Ingredients</h3>
        <div id="existing-ingredients-container"></div>
        <button type="button" onclick="addExistingIngredient()">+ Add Existing Ingredient</button>

        <script>
        const INGREDIENTS = <%- JSON.stringify(ingredients) %>;

        function addExistingIngredient() {
            const i = document.querySelectorAll('#existing-ingredients-container .ingredient-entry').length;
            const div = document.createElement('div');
            div.className = 'ingredient-entry';
            div.style = 'margin-top:10px; border:1px solid #ccc; padding:10px';
            div.innerHTML = `
            <label>Ingredient
                <select name="existing[${i}][id]" required>
                <option value="">-- choose --</option>
                ${INGREDIENTS.map(ing => `<option value="${ing.id}">${ing.name}</option>`).join('')}
                </select>
            </label><br>
            <label>Qty <input name="existing[${i}][quantity]" type="number" step="0.01"></label><br>
            <label>Unit
                <select name="existing[${i}][unit]">
                <option value="">unit</option>
                <option>cup</option><option>tbsp</option><option>tsp</option>
                <option>g</option><option>ml</option><option>oz</option><option>unit</option>
                </select>
            </label><br>
            <button type="button" onclick="this.parentElement.remove()">üóë Remove</button>
            `;
            document.getElementById('existing-ingredients-container').appendChild(div);
        }
        </script>

      <h3>Add New Ingredients</h3>
      <div id="new-ingredients-container"></div>
      <button type="button" onclick="addNewIngredient()">+ Add Ingredient</button>
      <script>
        function addNewIngredient() {
  const c = document.getElementById('new-ingredients-container');
  const i = c.children.length;
  const div = document.createElement('div');
  div.className = 'ingredient-entry';
  div.style = 'margin-top:10px; border:1px solid #ccc; padding:10px';
  div.innerHTML = `
    <label>Name <input name="new_ingredients[${i}][name]" required></label><br>
    <label>Qty <input name="new_ingredients[${i}][quantity]" type="number" step="0.01"></label><br>
    <label>Unit
      <select name="new_ingredients[${i}][unit]">
            <option value="">-- unit --</option>
            <option>cup</option><option>tbsp</option><option>tsp</option>
            <option>g</option><option>oz</option><option>ml</option><option>unit</option>
            </select>
            </label><br>
            <label>Price $ <input name="new_ingredients[${i}][price]" type="number" step="0.01"></label><br>
            <label>Prep Notes <input name="new_ingredients[${i}][preparation]" placeholder="e.g. chopped, melted"></label><br>
            <button type="button" onclick="this.parentElement.remove()">üóë Remove</button>
        `;
        c.appendChild(div);
    }
    </script>
    <p><button>Add Recipe</button></p>
    </form>
    <p><a href="/recipes">‚Üê Back to Recipes</a></p>
  </body>
</html>